ì•„ë˜ ë¬¸ì„œëŠ” â€œ1ë…„ì°¨ ì£¼ë‹ˆì–´ ê°œë°œìâ€ê°€ **Clerk ì»¤ìŠ¤í…€ OAuth(ë„¤ì´ë²„) ì—°ë™ì—ì„œ â€˜ë°ì´í„°ëŠ” ì˜¤ëŠ”ë° ë¡œê·¸ì¸/ìœ ì € ìƒì„±ì´ ì•ˆ ë˜ëŠ”â€™ ë¬¸ì œë¥¼ ëê¹Œì§€ ê²€ì¦**í•  ìˆ˜ ìˆê²Œ ë§Œë“  ì²´í¬ë¦¬ìŠ¤íŠ¸í˜• MDì…ë‹ˆë‹¤. ê·¸ëŒ€ë¡œ ë³µì‚¬í•´ì„œ ë…¸ì…˜/ê¹ƒí—™ì— ë¶™ì´ë©´ ë©ë‹ˆë‹¤.

---

# Clerk ë„¤ì´ë²„ ë¡œê·¸ì¸ â€œìœ ì € ìƒì„±/ë¡œê·¸ì¸ ì‹¤íŒ¨â€ ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸ (UserInfo Proxy ê¸°ë°˜)

**ì‘ì„±ì¼:** 2026-01-04

**ëª©í‘œ:**

- ë„¤ì´ë²„ OAuthëŠ” ì„±ê³µ(í† í°/ìœ ì €ì •ë³´ ìˆ˜ì‹ )í•˜ì§€ë§Œ
- Clerkì—ì„œ â€œìœ ì € ì •ë³´ ì—†ìŒ / ë¡œê·¸ì¸ ì•ˆ ë¨â€ì´ ë°œìƒí•˜ëŠ” ë¬¸ì œë¥¼
    
    **ë„¤íŠ¸ì›Œí¬ â†’ í”„ë¡ì‹œ â†’ Clerk ì„¤ì • â†’ ì•± í”Œë¡œìš°** ìˆœì„œë¡œ í™•ì • ì§„ë‹¨í•œë‹¤.
    

---

## 0) ì „ì œ(í˜„ì¬ êµ¬ì„±)

- Clerk Custom OAuth Provider ì‚¬ìš©
- ë„¤ì´ë²„ UserInfo ì‘ë‹µì´ ì¤‘ì²©(JSON)ì´ë¼ Proxy ì„œë²„ë¥¼ ë‘ 
- ProxyëŠ” ë„¤ì´ë²„ UserInfo(`https://openapi.naver.com/v1/nid/me`)ë¥¼ í˜¸ì¶œí•˜ê³ 
    
    `sub/email/name/picture` ë“± flat JSONìœ¼ë¡œ ë³€í™˜í•´ Clerkì— ë°˜í™˜
    

---

## 1) ì„±ê³µ ê¸°ì¤€(Definition of Done)

ì•„ë˜ 4ê°œê°€ ëª¨ë‘ ë§Œì¡±ë˜ë©´ â€œì—°ë™ ì„±ê³µâ€ì´ë‹¤.

1. **Clerk â†’ Proxy ìš”ì²­ì´ ì‹¤ì œë¡œ ë“¤ì–´ì˜¨ë‹¤**
2. Proxyê°€ ë„¤ì´ë²„ UserInfoë¥¼ **200 OK**ë¡œ ë°›ê³ ,
3. Proxyê°€ Clerkì— ë°˜í™˜í•˜ëŠ” ì‘ë‹µì— **`sub` + `email`*ì´ ì¡´ì¬í•œë‹¤
4. OAuth ì½œë°± ì´í›„ Clerkì—ì„œ **ì„¸ì…˜ ìƒì„±(createdSessionId)** í˜¹ì€ ë¡œê·¸ì¸ ì™„ë£Œê°€ ëœë‹¤
    
    (ì•±ì—ì„œ `currentUser`ê°€ nullì´ ì•„ë‹˜)
    

---

## 2) 1ì°¨ ì§„ë‹¨: â€œClerkê°€ Proxyë¥¼ ì§„ì§œ í˜¸ì¶œí•˜ë‚˜?â€ (ë„ë‹¬ì„±/HTTPS)

### 2.1 Proxy ë¡œê·¸ë¡œ í™•ì¸ (ê°€ì¥ ì¤‘ìš”)

Proxy ì„œë²„ ë¡œê·¸ì—ì„œ ì•„ë˜ê°€ ì°í˜€ì•¼ í•œë‹¤:

- `[INFO] ìš”ì²­ ìˆ˜ì‹ : GET /` ë˜ëŠ” `POST /`
- `[INFO] í—¤ë”: authorization: Bearer ***`

âœ… **íŒì •**

- ë¡œê·¸ê°€ **ì•ˆ ì°í˜** â†’ Clerkê°€ Proxyë¥¼ ëª» ë•Œë¦¼ = **ë„¤íŠ¸ì›Œí¬/HTTPS ë¬¸ì œ í™•ì •**
- ë¡œê·¸ê°€ **ì°í˜** â†’ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™

### 2.2 ì™¸ë¶€ ì ‘ê·¼ ì¡°ê±´ ì²´í¬(í•„ìˆ˜)

ClerkëŠ” â€œì‚¬ìš©ì ë¸Œë¼ìš°ì €â€ê°€ ì•„ë‹ˆë¼ **Clerk ì„œë²„ì—ì„œ** UserInfo URLì„ í˜¸ì¶œí•œë‹¤.

ë”°ë¼ì„œ Proxy ì—”ë“œí¬ì¸íŠ¸ëŠ” ì•„ë˜ ì¡°ê±´ì„ ë§Œì¡±í•´ì•¼ í•œë‹¤.

- [ ]  Public DNS ë˜ëŠ” ê³µì¸ IPë¡œ ì ‘ê·¼ ê°€ëŠ¥
- [ ]  **HTTPS ê¶Œì¥(ì‚¬ì‹¤ìƒ í•„ìˆ˜ë¡œ ë³´ëŠ” ê²Œ ì•ˆì „)**
- [ ]  ë°©í™”ë²½/ë³´ì•ˆê·¸ë£¹ì—ì„œ inbound í—ˆìš©(ì˜ˆ: 443)
- [ ]  (ê°€ëŠ¥í•˜ë©´) Nginx/Cloudflare/ALBë¡œ TLS ì¢…ë£Œ

ğŸ“Œ **ì£¼ì˜**

- `http://<ip>:3001/` ê°™ì€ í˜•íƒœëŠ” í™˜ê²½ì— ë”°ë¼ Clerkê°€ ì°¨ë‹¨/ì‹¤íŒ¨í•  ìˆ˜ ìˆìŒ
    
    â†’ **https://auth-proxy.example.com/userinfo** ê°™ì€ í˜•íƒœ ê¶Œì¥
    

---

## 3) 2ì°¨ ì§„ë‹¨: â€œMethod/Token ì „ë‹¬ ë°©ì‹ ë¶ˆì¼ì¹˜â€ (GETë§Œ í—ˆìš© ë¬¸ì œ)

í˜„ì¬ ProxyëŠ” GETë§Œ í—ˆìš©í•œë‹¤:

- GET âœ…
- OPTIONS âœ…
- POST âŒ (405 ë°˜í™˜)

### 3.1 Proxy ë¡œê·¸ì—ì„œ method í™•ì¸

- [ ]  Clerk ìš”ì²­ì´ `GET`ì¸ì§€ `POST`ì¸ì§€ í™•ì¸

âœ… **íŒì •**

- `POST`ë¡œ ì°íˆë©´ â†’ **ë°”ë¡œ ì›ì¸ í›„ë³´ 1ìˆœìœ„**
    - Proxyê°€ 405ë¡œ ë§‰ì•„ ClerkëŠ” UserInfoë¥¼ ëª» ë°›ê³  â€œìœ ì € ì—†ìŒâ€ìœ¼ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆë‹¤

### 3.2 í•´ê²° ê°€ì´ë“œ(ê¶Œì¥ íŒ¨ì¹˜)

- [ ]  GET + POST ë‘˜ ë‹¤ í—ˆìš©
- [ ]  Authorization í—¤ë”ê°€ ì—†ëŠ” ê²½ìš° `access_token` queryë„ fallback í—ˆìš©

(íŒ¨ì¹˜ëŠ” ì‹œë‹ˆì–´ê°€ PRë¡œ ì œê³µí•˜ê±°ë‚˜, ì•„ë˜ TODOì— ë”°ë¼ ìˆ˜ì •)

**TODO**

- [ ]  `req.method !== "GET" && req.method !== "POST"` í˜•íƒœë¡œ ìˆ˜ì •
- [ ]  `access_token` query param ì§€ì› ì¶”ê°€

---

## 4) 3ì°¨ ì§„ë‹¨: â€œProxy ì‘ë‹µì´ Clerkê°€ ê¸°ëŒ€í•˜ëŠ” í•„ë“œë¥¼ ë§Œì¡±í•˜ë‚˜?â€ (sub/email)

Clerkê°€ ìœ ì €ë¥¼ ìƒì„±í•˜ë ¤ë©´ ìµœì†Œí•œ ë‹¤ìŒì´ ì•ˆì •ì ìœ¼ë¡œ í•„ìš”í•˜ë‹¤:

- **ê³ ìœ  ì‹ë³„ì:** `sub`
- **ì´ë©”ì¼:** `email` (ì¸ìŠ¤í„´ìŠ¤ ì„¤ì •ì— ë”°ë¼ í•„ìˆ˜)

### 4.1 Proxy ì‘ë‹µ JSON í™•ì¸

Proxy ë¡œê·¸ì— ì°íŒ ìµœì¢… ì‘ë‹µ(flat JSON)ì— ì•„ë˜ê°€ ìˆëŠ”ì§€ í™•ì¸:

- [ ]  `sub` ê°’ ì¡´ì¬
- [ ]  `email` ê°’ ì¡´ì¬
- [ ]  `name` (ê¶Œì¥)
- [ ]  `picture` (ê¶Œì¥)

âœ… **íŒì •**

- `sub` ì—†ìŒ â†’ ë„¤ì´ë²„ `response.id` íŒŒì‹±/ê¶Œí•œ ë¬¸ì œ
- `email` ì—†ìŒ â†’ ë„¤ì´ë²„ì—ì„œ email scope/ë™ì˜ ëˆ„ë½ ê°€ëŠ¥ì„±ì´ í¼

### 4.2 ë„¤ì´ë²„ ì¸¡ ì„¤ì • ì²´í¬(ì´ë©”ì¼ ë™ì˜)

- [ ]  ë„¤ì´ë²„ ê°œë°œì ì½˜ì†”ì—ì„œ â€œì œê³µ ì •ë³´â€ì— ì´ë©”ì¼ì´ í¬í•¨ë˜ì–´ ìˆëŠ”ê°€?
- [ ]  ì‹¤ì œ ë¡œê·¸ì¸ í™”ë©´ì—ì„œ ì´ë©”ì¼ ì œê³µ ë™ì˜ê°€ ëœ¨ëŠ”ê°€?

ğŸ“Œ ì´ë©”ì¼ì€ â€œì‚¬ìš©ìê°€ ë™ì˜ ì•ˆ í•˜ë©´â€ nullë¡œ ì˜¬ ìˆ˜ ìˆë‹¤.

ì¦‰, â€œí•„ìˆ˜ë¡œ ë°›ëŠ”ë‹¤â€ê³  ìƒê°í•´ë„ ì‹¤ì œë¡  ë¹ ì§ˆ ìˆ˜ ìˆë‹¤.

---

## 5) 4ì°¨ ì§„ë‹¨: â€œClerk Dashboard ë§¤í•‘ì´ ë§ë‚˜?â€ (Attribute mapping)

Proxyê°€ ì™„ë²½í•´ë„, Clerkì—ì„œ ë§¤í•‘ì´ í‹€ë¦¬ë©´ ë¡œê·¸ì¸/ìœ ì €ìƒì„±ì´ ì•ˆ ëœë‹¤.

### 5.1 ìµœì†Œ ë§¤í•‘(ë°˜ë“œì‹œ)

Clerk Dashboard â†’ Custom OAuth Provider ì„¤ì •ì—ì„œ:

- [ ]  User ID / Subject â†’ `sub`
- [ ]  Email â†’ `email`

### 5.2 ê¶Œì¥ ë§¤í•‘

- [ ]  Name â†’ `name`
- [ ]  Avatar/Picture â†’ `picture`

âœ… **íŒì •**

- `sub/email` ë‘˜ ë‹¤ ì‘ë‹µì— ìˆëŠ”ë°ë„ ì‹¤íŒ¨í•œë‹¤ë©´
    
    â†’ ë§¤í•‘ì´ ì˜ëª»ëì„ í™•ë¥ ì´ ë§¤ìš° ë†’ë‹¤(í•„ë“œëª… ì˜¤íƒ€, ë‹¤ë¥¸ í‚¤ë¡œ ë§¤í•‘ ë“±)
    

---

## 6) 5ì°¨ ì§„ë‹¨: â€œì•±(Next.js)ì—ì„œ OAuth ì½œë°± ì²˜ë¦¬ í”Œë¡œìš°ê°€ ì™„ë£Œë˜ë‚˜?â€

### 6.1 ëŒ€í‘œ ì¦ìƒ

- ë„¤ì´ë²„ ë¡œê·¸ì¸ ì„±ê³µ
- Proxyë„ ì •ìƒ 200
- ê·¸ëŸ°ë° ì•±ì—ì„œ `currentUser`ê°€ ê³„ì† null

ì´ ê²½ìš°ëŠ” **ì„¸ì…˜ ìƒì„±ì´ ì™„ë£Œë˜ì§€ ì•Šì•˜ê±°ë‚˜**, â€œì¶”ê°€ ì •ë³´ í•„ìš”(missing requirements)â€ ìƒíƒœì¼ ìˆ˜ ìˆë‹¤.

### 6.2 í™•ì¸ í¬ì¸íŠ¸

- [ ]  OAuth ì½œë°± ì´í›„ì— Clerkê°€ **ì„¸ì…˜ì„ ìƒì„±í–ˆëŠ”ì§€** í™•ì¸
- [ ]  ì»¤ìŠ¤í…€ UI/ì»¤ìŠ¤í…€ ë¼ìš°íŒ…ì„ ì“´ë‹¤ë©´ ì½œë°± ì²˜ë¦¬ ì½”ë“œì—ì„œ
    
    â€œì„¸ì…˜ ìƒì„± ID(createdSessionId)â€ê°€ ë¹„ì–´ìˆëŠ” ì¼€ì´ìŠ¤ë¥¼ ì²˜ë¦¬í•˜ëŠ”ì§€ í™•ì¸
    

âœ… **íŒì •**

- createdSessionIdê°€ ë¹„ì–´ìˆë‹¤ â†’ â€œì¶”ê°€ ì •ë³´ ì…ë ¥ í•„ìš”â€ í”Œë¡œìš°ë¥¼ íƒœì›Œì•¼ í•¨



[{"timestamp":"2026-01-04T10:16:06.426Z","level":"log","message":"ğŸ’¾ ëª¨ë“  ì½˜ì†” ë¡œê·¸ê°€ localStorageì— ì €ì¥ë©ë‹ˆë‹¤.","args":["ğŸ’¾ ëª¨ë“  ì½˜ì†” ë¡œê·¸ê°€ localStorageì— ì €ì¥ë©ë‹ˆë‹¤."]},{"timestamp":"2026-01-04T10:16:06.426Z","level":"log","message":"   - getStoredLogs(): ì €ì¥ëœ ë¡œê·¸ ê°€ì ¸ì˜¤ê¸°","args":["   - getStoredLogs(): ì €ì¥ëœ ë¡œê·¸ ê°€ì ¸ì˜¤ê¸°"]},{"timestamp":"2026-01-04T10:16:06.427Z","level":"log","message":"   - clearStoredLogs(): ë¡œê·¸ ì´ˆê¸°í™”","args":["   - clearStoredLogs(): ë¡œê·¸ ì´ˆê¸°í™”"]},{"timestamp":"2026-01-04T10:16:06.427Z","level":"log","message":"   - replayStoredLogs(): ë¡œê·¸ ì¬ìƒ","args":["   - replayStoredLogs(): ë¡œê·¸ ì¬ìƒ"]},{"timestamp":"2026-01-04T10:16:06.872Z","level":"log","message":"[Client Instrumentation Hook] Slow execution detected: 33ms (Note: Code download overhead is not included in this measurement)","args":["[Client Instrumentation Hook] Slow execution detected: 33ms (Note: Code download overhead is not included in this measurement)"]},{"timestamp":"2026-01-04T10:16:06.879Z","level":"info","message":"%cDownload the React DevTools for a better development experience: https://react.dev/link/react-devtools font-weight:bold","args":["%cDownload the React DevTools for a better development experience: https://react.dev/link/react-devtools","font-weight:bold"]},{"timestamp":"2026-01-04T10:16:07.226Z","level":"group","message":"%c%s%c [HomePage] ìƒí’ˆ ë°ì´í„° fetching background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server  ","args":["%c%s%c [HomePage] ìƒí’ˆ ë°ì´í„° fetching","background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px"," Server ",""]},{"timestamp":"2026-01-04T10:16:07.226Z","level":"log","message":"%c%s%c [HomePage] ìƒí’ˆ ë°ì´í„° fetching background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server  ","args":["%c%s%c [HomePage] ìƒí’ˆ ë°ì´í„° fetching","background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px"," Server ",""]},{"timestamp":"2026-01-04T10:16:07.227Z","level":"warn","message":"%c%s%c  \u001b[33m\u001b[1mâš \u001b[22m\u001b[39m Unsupported metadata viewport is configured in metadata export in /. Please move it to viewport export instead.\nRead more: https://nextjs.org/docs/app/api-reference/functions/generate-viewport background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server  ","args":["%c%s%c  \u001b[33m\u001b[1mâš \u001b[22m\u001b[39m Unsupported metadata viewport is configured in metadata export in /. Please move it to viewport export instead.\nRead more: https://nextjs.org/docs/app/api-reference/functions/generate-viewport","background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px"," Server ",""]},{"timestamp":"2026-01-04T10:16:07.237Z","level":"log","message":"%c%s%c [DEBUG] [HomePage] ë² ìŠ¤íŠ¸ 1ë²ˆ ë§¤ì¹­ (100ì ) background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {\n  \"target\": \"ì‚°ë¦¬ì˜¤ í—¬ë¡œí‚¤í‹° ë¸”ë™ì—”ì ¤ ìŠ¤íƒ€ì¼ì—… ë¡±ë‹¤ë¦¬ ë§ˆìŠ¤ì½”íŠ¸ ì¸í˜•...\",\n  \"found\": \"ì‚°ë¦¬ì˜¤ í—¬ë¡œí‚¤í‹° ë¸”ë™ì—”ì ¤ ìŠ¤íƒ€ì¼ì—… ë¡±ë‹¤ë¦¬ ë§ˆìŠ¤ì½”íŠ¸ ì¸í˜•...\"\n}","args":["%c%s%c [DEBUG] [HomePage] ë² ìŠ¤íŠ¸ 1ë²ˆ ë§¤ì¹­ (100ì )","background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px"," Server ","",{"target":"ì‚°ë¦¬ì˜¤ í—¬ë¡œí‚¤í‹° ë¸”ë™ì—”ì ¤ ìŠ¤íƒ€ì¼ì—… ë¡±ë‹¤ë¦¬ ë§ˆìŠ¤ì½”íŠ¸ ì¸í˜•...","found":"ì‚°ë¦¬ì˜¤ í—¬ë¡œí‚¤í‹° ë¸”ë™ì—”ì ¤ ìŠ¤íƒ€ì¼ì—… ë¡±ë‹¤ë¦¬ ë§ˆìŠ¤ì½”íŠ¸ ì¸í˜•..."}]},{"timestamp":"2026-01-04T10:16:07.237Z","level":"log","message":"%c%s%c [DEBUG] [HomePage] ë² ìŠ¤íŠ¸ 2ë²ˆ ë§¤ì¹­ (100ì ) background: #e6e6e6;background: light-dark(rgba(0,0,0,0.1), rgba(255,255,255,0.25));color: #000000;color: light-dark(#000000, #ffffff);border-radius: 2px  Server   {\n  \"target\": \"ì‚°ë¦¬ì˜¤ í—¬ë¡œí‚¤í‹° íŒíƒ€ì§€ ìŠ¤